!function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=111)}({111:function(e,t,r){"use strict";var n=r(68),a=r(42);!function(e){e.CubeRemoteDesktopServiceWorker=n.RemoteDesktopServiceWorker,e.CubeRemoteDesktopListener=a.RemoteDesktopListener}(window)},112:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.RemoteDesktopService=function(e){function t(){return n(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),i(t,[{key:"shareWith",value:function(e){}},{key:"revokeSharing",value:function(){}},{key:"apply",value:function(e){}},{key:"leave",value:function(){}}]),t}(CubeService)},113:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Action={Share:"share",ShareAck:"share-ack",Apply:"apply",ApplyAck:"apply-ack",RevokeShare:"revoke-share",RevokeShareAck:"revoke-share-ack",Leave:"leave",LeaveAck:"leave-ack"}},42:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.RemoteDesktopListener=function(e){function t(){return n(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),i(t,[{key:"onShared",value:function(){}},{key:"onRevoked",value:function(){}},{key:"onRemoteShare",value:function(e,t){}},{key:"onConnectShare",value:function(e,t){}},{key:"onLeaveShare",value:function(e,t){}},{key:"onFailed",value:function(e){}}]),t}(CubeListener)},68:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteDesktopServiceWorker=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=r(112),s=r(42),l=r(113);t.RemoteDesktopServiceWorker=function(e){function t(e,r,o){n(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s.RemoteDesktopListener,CELLET.RemoteDesktop));return i.msgCache=new HashMap,i.rdWorker=r,i.shareMachine=null,i.clientMachine=null,i.viewDom=o,i.timeout=1e4,i.lastShareWithTime=0,i.currentRDSN=null,i.peers=null,i.sharer=null,i}return o(t,e),i(t,[{key:"shareWith",value:function(e){var t={members:e,isCall:!0};return this.engine.connect.send(CELLET.RemoteDesktop,CubeConst.Share,t)}},{key:"revokeSharing",value:function(){null!=this.shareMachine&&(this.shareMachine.stop(),this.shareMachine=null,this.engine.connect.send(CELLET.RemoteDesktop,CubeConst.RevokeShare,{sharer:this.engine.accName}),this.engine.getCallService().terminateCall(),this.peers=null)}},{key:"apply",value:function(e){return this.engine.connect.send(CELLET.RemoteDesktop,CubeConst.Apply,{sharer:e})}},{key:"leave",value:function(){null!=this.clientMachine&&(this.clientMachine.stop(),this.clientMachine=null,this.engine.connect.send(CELLET.RemoteDesktop,CubeConst.Leave,{sharer:this.sharer}),this.engine.getCallService().terminateCall())}},{key:"_processShare",value:function(e){var t=e.getParam("state");if(200==t.code){var r=e.getParam("data");this.currentRDSN=r.RDServer.sn,this.delegate.onRemoteShare(r.sharer,this.engine.accName)}else this.delegate.onFailed(new CubeError(t.code,t.desc))}},{key:"_processShareAck",value:function(e){var t=e.getParam("state");if(200==t.code){var r=e.getParam("data");this.currentRDSN=r.RDServer.sn,this.shareMachine=this.rdWorker.createSharer(r.RDServer.host+":"+r.RDServer.port,r.RDServer.sn+"",this.engine.accName),this.shareMachine.start(),this.delegate.onShared();var n=this.engine.getCallService();null!==n&&null!=r.groupId&&n.makeCall(r.groupId,!1)}else this.delegate.onFailed(new CubeError(t.code,t.desc))}},{key:"_processApplyAck",value:function(e){var t=e.getParam("state");if(200===t.code){var r=e.getParam("data");this.clientMachine=this.rdWorker.createClient(r.RDServer.host+":"+r.RDServer.port,r.RDServer.sn+""),this.sharer=r.sharer;var n=this,a={};this.clientMachine.on("connect",function(){var e=n.engine.getCallService();null!==e&&null!=r.groupId&&e.makeCall(r.groupId,!1),n.delegate.onConnectShare(r.sharer,n.engine.accName)}),this.clientMachine.on("bitmap",function(e,t,r,o,i){var c=URL.createObjectURL(new Blob([new Uint8Array(e).buffer])),s=new Image;s.onload=function(){var e="r"+o+"c"+i,l=a[e];null==l&&(l={avgWidth:0,lastWidth:0,avgHeight:0,lastHeight:0}),t<o?l.avgHeight=s.height:l.lastHeight=s.height,r<i?l.avgWidth=s.width:l.lastWidth=s.width,a[e]=l;var u=void 0,h=void 0,p=document.getElementById("__cube_remote_desktop_canvas");null===p&&(p=document.createElement("canvas"),p.id="__cube_remote_desktop_canvas",p=n.viewDom.appendChild(p)),u=l.avgWidth>0&&l.lastWidth>0?l.avgWidth*i+l.lastWidth:p.width>0?p.width:l.avgWidth>0?l.avgWidth*(i+1):l.lastWidth*(i+1),h=l.avgHeight>0&&l.lastHeight>0?l.avgHeight*o+l.lastHeight:p.height>0?p.height:l.avgHeight>0?l.avgHeight*(o+1):l.lastHeight*(o+1);var v=p.getContext("2d");if(p.width>0){if(u!==p.width||h!==p.height){var f=v.getImageData(0,0,p.width,p.height);p.width=u,p.height=h,v.putImageData(f,0,0),a={},a[e]=l}}else p.width=u,p.height=h;v.drawImage(s,r<i?r*s.width:p.width-s.width,t<o?t*s.height:p.height-s.height),URL.revokeObjectURL(c),s=null},s.src=c}),this.clientMachine.on("cursor",function(e,t){var r=document.getElementById("__cube_remote_desktop_cursor");null===r&&(r=document.createElement("img"),r.id="__cube_remote_desktop_cursor",r.style.display="block",r.style.position="absolute",r.style.transition="left .3s, top .3s",r.style.width="15px",r.src=n.engine.resourcePath+"/rd/cursor.png",n.viewDom.appendChild(r)),r.style.left=e+"px",r.style.top=t+"px"}),this.clientMachine.on("close",function(){n.delegate.onLeaveShare(r.sharer,n.engine.accName)}),this.clientMachine.start()}else this.delegate.onFailed(new CubeError(t.code,t.desc))}},{key:"_processRevokeShare",value:function(e){var t=e.getParamAsString("state");if(200===t.code){var r=e.getParamAsString("data");this.currentRDSN===r.RDServer.sn&&(this.clientMachine.stop(),this.clientMachine=null,this.engine.getCallService().terminateCall())}else this.delegate.onFailed(new CubeError(t.code,t.desc))}},{key:"_processRevokeShareAck",value:function(e){var t=e.getParamAsString("state");if(200===t.code){var r=e.getParamAsString("data");this.currentRDSN===r.RDServer.sn&&(this.currentRDSN=null,this.delegate.onRevoked())}else this.delegate.onFailed(new CubeError(t.code,t.desc))}},{key:"_processLeave",value:function(e){var t=e.getParamAsString("state");if(200===t.code){var r=e.getParamAsString("data");this.currentRDSN===r.RDServer.sn&&this.delegate.onLeaveShare(this.engine.accName,r.target)}else this.delegate.onFailed(new CubeError(t.code,t.desc))}},{key:"_processLeaveAck",value:function(e){var t=e.getParamAsString("state");if(200==t.code){var r=e.getParamAsString("data");this.currentRDSN===r.RDServer.sn&&(this.sharer=null,this.delegate.onLeaveShare(r.sharer,this.engine.accName))}else this.delegate.onFailed(new CubeError(t.code,t.desc))}},{key:"onRegisterStateChanged",value:function(e){}},{key:"onDialogue",value:function(e,t){switch(e){case l.Action.Share:this._processShare(t);break;case l.Action.ShareAck:this._processShareAck(t);break;case l.Action.Apply:break;case l.Action.ApplyAck:this._processApplyAck(t);break;case l.Action.RevokeShare:this._processRevokeShare(t);break;case l.Action.RevokeShareAck:this._processRevokeShareAck(t);break;case l.Action.Leave:this._processLeave(t);break;case l.Action.LeaveAck:this._processLeaveAck(t)}}}]),t}(c.RemoteDesktopService)}});
//# sourceMappingURL=cube-rd.js.map