!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=78)}([,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.CubeError=function e(t,n){i(this,e),this.code=t,this.message=n}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StateCode={Ok:200,Accepted:202,NoContent:204,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UnsupportedMediaType:415,ExpectationFailed:417,TooManyRequests:429,RequestSendFailed:477,TemporarilyUnavailable:480,BusyHere:486,RequestTerminated:487,ServerInternalError:500,GatewayTimeout:504,GetLicenseFail:500,BusyEverywhere:600,Declined:603,DoesNotExistAnywhere:604,ConnectionFailed:700,SignalingStartError:701,TransportError:702,ICEConnectionFailed:703,ParamError:704,CreateSessionDescriptionFailed:705,SetSessionDescriptionFailed:706,RTCInitializeFailed:707,DuplicationException:710,WorkerStateException:711,CallTimeout:712,NotFoundConference:713,UnexpectedCanceled:714,IncorrectState:801,NetworkNotReachable:809,ContentTooLong:810,BlockOversize:811,FormatError:812,ContentError:813,OutOfLimit:814,NoReceiver:815,RecallTimeout:816,NullMessage:817,MessageExpire:818,LostAssets:820,UploadFailed:823,ProcessFailed:825,LoadFileFailed:828,AnswerByOther:900,CancelByOther:901,Unknown:0,InitFailed:1001,LoadLicenseFailed:1002,LicenseOutDate:1003,UnRegister:1004,LicenseServerError:1005,LicenseUpdateError:1006,ReLoginTimeout:1007,RecallError:1100,ForwardError:1101,VoiceClipTooShort:1102,VideoClipTooShort:1103,MessageNotExist:1104,MessageTimeout:1105,ReceiptError:1106,QueryNOData:1107,DispatchFailed:1108,OutDateMessage:1109,FileMessageDownloadFailed:1110,FileMessageDownloadTimeout:1111,NotFoundReceiptMessage:1114,SetTopError:1117,FileNotExistOnServer:1200,FileUploadError:1201,FileDataFormatError:1202,RenamedFailed:1203,CubeStateLoadFileFailed:1204,DeleteFailed:1205,MkdirFailed:1206,FileUsedByOther:1207,GroupAddMasterFailed:1300,GroupRemoveMasterFailed:1301,GroupDestory:1302,GroupNotExist:1303,AlreadyInCalling:1400,ConferenceExist:1500,OverMaxNumber:1501,ConferenceRejectByOther:1502,ConferenceJoinFromOther:1503,ConferenceJoinFailed:1506,ConferenceRejectFailed:1507,ConferenceClosed:1508,ConferenceSipInviteFailed:1551,ConferenceTimeout:1552,ExportWhiteboardFailed:1600,ImportWhiteboardFailed:1601,WhiteboardNotExist:1602,WhiteboardUploadFailed:1603,WhiteboardConvertFailed:1604,CameraOpenFailed:1700,ActiveAudioSessionFailed:1701,MicphoneOpenFailed:1702,VideoConvertFailed:1703,AudioRecorderInitialFailed:1704,AudioRecorderPrepareFailed:1705,AudioPlayDecodeFailed:1706,NotSupportUserMedia:1707,LiveStartFailed:1800,LiveNotExist:1801,NotHavePermission:1e4}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CELLET={Master:"CubeMaster",Responder:"CubeResponder",Instruction:"CubeInstruction",Messaging:"CubeMessaging",Signaling:"CubeSignaling",Whiteboard:"CubeWhiteboard",RemoteDesktop:"CubeRDServer",Live:"CubeLive"}},,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.Listener=function(){function e(){i(this,e)}return o(e,[{key:"onFailed",value:function(e){}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RegistrationState={None:"None",Progress:"Progress",Ok:"Ok",Cleared:"Cleared",Failed:"Failed"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CubeConst={ActionLogin:"login",ActionLoginAck:"login-ack",ActionLogout:"logout",ActionLogoutAck:"logout-ack",ActionQuery:"query",ActionQueryAck:"query-ack",ActionQueryDevice:"query-device",ActionQueryDeviceAck:"query-device-ack",ActionQueryByIdDevice:"query-device-by-id",ActionQueryByIdDeviceAck:"query-device-by-id-ack",ActionPush:"push",ActionPushAck:"push-ack",ActionPull:"pull",ActionPullAck:"pull-ack",ActionNotify:"notify",ActionRecall:"recall",ActionRecallAck:"recall-ack",ActionReceipt:"receipt",ActionReceiptAck:"receipt-ack",ActionReceiptAll:"receipt-all",ActionReceiptAllAck:"receipt-all-ack",ActionReceiptOffline:"receipt-offline",ActionReceiptOfflineAck:"receipt-offline-ack",ActionForward:"forward",ActionForwardAck:"forward-ack",ActionHistory:"history",ActionHistoryAck:"history-ack",ActionSearchMsg:"search-msg",ActionSearchMsgAck:"search-msg-ack",ActionSearchMsgs:"search-msgs",ActionSearchMsgsAck:"search-msgs-ack",ActionSync:"sync",ActionSyncAck:"sync-ack",ActionUpdateTop:"update-top",ActionUpdateTopAck:"update-top-ack",ActionInvite:"invite",ActionInviteAck:"invite-ack",ActionAnswer:"answer",ActionAnswerAck:"answer-ack",ActionCancel:"cancel",ActionCancelAck:"cancel-ack",ActionBye:"bye",ActionByeAck:"bye-ack",ActionCandidate:"candidate",ActionCandidateAck:"candidate-ack",ActionConsult:"consult",ActionConsultAck:"consult-ack",ActionReply:"reply",ActionReplyAck:"reply-ack",ActionTryReInvite:"try-reinvite",ActionTryReInviteAck:"try-reinvite-ack",ActionReverseCall:"reverse-call",ActionShare:"share",ActionShareAck:"share-ack",ActionRevoke:"revoke",ActionRevokeAck:"revoke-ack",ActionVGCmd:"vg-cmd",ActionVGCmdAck:"vg-cmd-ack",ActionRestrain:"restrain",ActionRestrainAck:"restrain-ack",ActionQueryWB:"query-wb",ActionQueryWBAck:"query-wb-ack",ActionQueryShared:"query-shared",ActionQuerySharedAck:"query-shared-ack",ActionInviteWB:"invite-wb",ActionInviteWBAck:"invite-wb-ack",ActionRejectWE:"reject-wb",ActionRejectWEAck:"reject-wb-ack",ActionCreateGroup:"create-group",ActionCreateGroupAck:"create-group-ack",ActionDeleteGroup:"delete-group",ActionDeleteGroupAck:"delete-group-ack",ActionAddMember:"add-member",ActionAddMemberAck:"add-member-ack",ActionRemoveMember:"remove-member",ActionRemoveMemberAck:"remove-member-ack",ActionQueryGroups:"query-groups",ActionQueryGroupsAck:"query-groups-ack",ActionGetGroup:"get-group",ActionGetGroupAck:"get-group-ack",ActionAddMaster:"add-master",ActionAddMasterAck:"add-master-ack",ActionRemoveMaster:"remove-master",ActionRemoveMasterAck:"remove-master-ack",ActionChangeGroupName:"set-grp-dn",ActionChangeGroupNameAck:"set-grp-dn-ack",ActionConference:"conference",ActionConferenceAck:"conference-ack",ActionQueryConference:"query-conference",ActionQueryConferenceAck:"query-conference-ack",ActionQueryAllConference:"query-all-conference",ActionQueryAllConferenceAck:"query-all-conference-ack",ActionJoinConference:"apply-join-conference",ActionJoinConferenceAck:"apply-join-conference-ack",ActionApplyConference:"apply-conference",ActionApplyConferenceAck:"apply-conference-ack",ActionCloseConference:"close-conference",ActionCloseConferenceAck:"close-conference-ack",ActionRejectConference:"reject-conference",ActionRejectConferenceAck:"reject-conference-ack",ActionInviteConference:"invite-conference",ActionInviteConferenceAck:"invite-conference-ack",ActionTryReInviteConference:"try-reinvite-conference",ActionTryReInviteConferenceAck:"try-reinvite-conference-ack",ActionAccept:"accept",ActionAcceptAck:"accept-ack",ActionTime:"time",ActionTimeAck:"time-ack",ActionRespond:"respond",ActionRespondAck:"respond-ack",ActionQueryRespond:"query-respond",ActionQueryRespondAck:"query-respond-ack",ActionGo:"go",ActionGoAck:"go-ack",ActionPrepare:"prepare",ActionPrepareAck:"prepare-ack",ActionFeedback:"feedback",ActionFeedbackAck:"feedback-ack",ActionLast:"last",ActionLastAck:"last-ack",Unknown:"unknown"}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.Delegate=function(){function e(t){i(this,e),this.listeners=null,this.init(t)}return o(e,[{key:"init",value:function(e){var t=this;this.listeners=[];var n=Object.getOwnPropertyNames(e.prototype),i=!0,o=!1,r=void 0;try{for(var a,s=n[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){(function(){var e=a.value;if("constructor"===e)return"continue";t[e]=function(){for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];t.did(e,i)}})()}}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}}},{key:"addListener",value:function(e){this.listeners.push(e)}},{key:"removeListener",value:function(e){for(var t=0;t<this.listeners.length;++t){if(this.listeners[t]===e){this.listeners.splice(t,1);break}}}},{key:"did",value:function(e,t){for(var n=0;n<this.listeners.length;n++){var i=this.listeners[n];i&&"function"==typeof i[e]&&i[e].apply(i,t)}}}]),e}()},,,,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Service=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(9);t.Service=function(){function e(t,n,o){i(this,e),this.engine=t,this._cellet=o,"function"==typeof n&&(this.delegate=new r.Delegate(n))}return o(e,[{key:"addListener",value:function(e){this.delegate.addListener(e)}},{key:"removeListener",value:function(e){this.delegate.removeListener(e)}},{key:"startup",value:function(){"string"==typeof this._cellet&&this.engine.addCelletMember(this._cellet,this),this.onStartup()}},{key:"shutdown",value:function(){"string"==typeof this._cellet&&this.engine.removeCelletMember(this._cellet,this),this.onShutdown()}},{key:"onStartup",value:function(){}},{key:"onShutdown",value:function(){}},{key:"onConfigure",value:function(e){}},{key:"onDialogue",value:function(e,t){}},{key:"onRegisterStateChanged",value:function(e){}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.CubeRequest=function(){function e(t){i(this,e),this.domain=t}return r(e,[{key:"send",value:function(e,t,n){for(var i in t)"object"===o(t[i])&&(t[i]=JSON.stringify(t[i]));Ajax.newRequest(this.domain+e).method("POST").content(t).send(function(e){var t=e.getStatus();if(200===t){var i=void 0;try{i=JSON.parse(e.getData())}catch(t){i=e.getData()}n(!1,i)}else n({status:t})})}},{key:"sendFile",value:function(e,t,n,i){if(window.FormData){var o=new FormData;for(var r in n)o.append(r,n[r]);if(t.value instanceof HTMLElement){var a=t.value.files[0];o.append(t.name,a,a.name)}else t.value instanceof Blob&&o.append(t.name,t.value,t.value.name);var s=new XMLHttpRequest;s.open("post",this.domain+e,!0),s.send(o),s.onload=function(){if(200===s.status){var e=void 0;try{e=JSON.parse(s.responseText)}catch(t){e=s.responseText}i(!1,e)}else i({status:s.status})}}}}]),e}()},,,,,,,,,,function(e,t,n){"use strict";var i,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":o(window))&&(i=window)}e.exports=i},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.CubeConfig=function(){function e(t){if(i(this,e),this.videoSize={width:320,height:240},this.autoSyncMsg=!0,this.debug=!1,this.appkey="",this.appid="",this.resourceDir="./assets",this.audioCodec="",this.videoCodec="",this.licenseServer=" http://license.getcube.cn/auth/license/get",this.frameRate={min:5,max:15},this.bandwidth={audio:70,video:512},this.socketEnabled=!0,"object"==(void 0===t?"undefined":o(t)))for(var n in t)if(this.hasOwnProperty(n)&&t.hasOwnProperty(n)){if("frameRate"===n){var r=parseInt(t.frameRate.min),a=parseInt(t.frameRate.max);this.frameRate={min:r>10?10:r<2?2:r,max:a>30?30:a<6?6:a}}this[n]=t[n]}}return r(e,[{key:"setAppId",value:function(e){this.appid=e}},{key:"setAppKey",value:function(e){this.appkey=e}},{key:"setAutoSyncMsg",value:function(e){this.autoSyncMsg=e}},{key:"setResourceDir",value:function(e){this.resourceDir=e}},{key:"setDebug",value:function(e){this.debug=e}},{key:"setVideoSize",value:function(e,t){this.videoSize={width:e,height:t}}},{key:"setAudioCodec",value:function(e){this.audioCodec=e}},{key:"setVideoCodec",value:function(e){this.videoCodec=e}},{key:"setLicenseServer",value:function(e){this.licenseServer=e}},{key:"setFrameRate",value:function(e,t){this.frameRate={min:e,max:t}}},{key:"setBandwidth",value:function(e,t){this.bandwidth={audio:e,video:t}}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CubeState={Start:"Start",Pause:"Pause",Ready:"Ready",Busy:"Busy",Stop:"Stop"}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(7),a=n(4);t.Session=function(){function e(){i(this,e),this.name=null,this.displayName=null,this.regState=r.RegistrationState.None,this.callPeer=null,this.callDirection=null,this.callState=null,this.latency=-1,this.callTime=0}return o(e,[{key:"getName",value:function(){return this.name}},{key:"getDisplayName",value:function(){return this.displayName}},{key:"hasRegistered",value:function(){return this.regState==r.RegistrationState.Ok}},{key:"getRegState",value:function(){return this.regState}},{key:"setCallPeer",value:function(e){this.callPeer=e}},{key:"getCallPeer",value:function(){return this.callPeer}},{key:"getCallDirection",value:function(){return this.callDirection}},{key:"isCalling",value:function(){return null!=cube.getCallService()&&(this.callState==CubeSignalingState.Invite||this.callState==CubeSignalingState.Incall||this.callState==CubeSignalingState.Progress||this.callState==CubeSignalingState.Ringing)}},{key:"isConferenceCall",value:function(){return null!=this.callPeer&&null!=this.callPeer.name&&this.callPeer.name.length<=4}},{key:"getLatency",value:function(){return this.isCalling()?this.latency:this.getMainLatency()}},{key:"getMainLatency",value:function(){var e=-1;nucleus.talkService.isCalled(a.CELLET.Signaling)&&(e=nucleus.talkService.getPingPongTime(a.CELLET.Signaling));var t=-1;nucleus.talkService.isCalled(a.CELLET.Messaging)&&(t=nucleus.talkService.getPingPongTime(a.CELLET.Messaging));var n=-1;nucleus.talkService.isCalled(a.CELLET.Whiteboard)&&(n=nucleus.talkService.getPingPongTime(a.CELLET.Whiteboard));var i=0,o=0;return e>0&&(o+=e,++i),t>0&&(o+=t,++i),n>0&&(o+=n,++i),i>0?parseInt(Math.round(o/i)):-1}},{key:"getCallTime",value:function(){return this.callTime}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceListener=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(6);t.DeviceListener=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),a(t,[{key:"onDeviceOnline",value:function(e,t){}},{key:"onDeviceOffline",value:function(e,t){}}]),t}(s.Listener)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.GroupContext=function(){function e(t){i(this,e),this.data=t}return o(e,[{key:"getName",value:function(){return this.data.name}},{key:"getId",value:function(){return this.data.name}},{key:"getDisplayName",value:function(){return this.data.displayName}},{key:"getFounder",value:function(){return this.data.founder}},{key:"getCreated",value:function(){return this.data.created}},{key:"getMembers",value:function(){return this.data.members}},{key:"getMasters",value:function(){return this.data.masters}},{key:"getGuests",value:function(){return void 0===this.data.guests?null:this.data.guests}},{key:"isOpen",value:function(){return this.data.open}},{key:"getConference",value:function(){if(this.data.attachment){if(void 0!==this.data.attachment.conference)return this.data.attachment.conference}else if(void 0!==this.data.conference)return this.data.conference;return null}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.GroupListener=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(6);t.GroupListener=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),a(t,[{key:"onGroupCreated",value:function(e,t){}},{key:"onGroupDeleted",value:function(e){}},{key:"onMemberAdded",value:function(e,t,n){}},{key:"onMemberRemoved",value:function(e,t,n){}},{key:"onMasterAdded",value:function(e,t){}},{key:"onMasterRemoved",value:function(e,t){}},{key:"onGroupNameChanged",value:function(e){}},{key:"onFailed",value:function(e){}}]),t}(s.Listener)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.UserListener=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(6);t.UserListener=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),a(t,[{key:"onLogined",value:function(e){}},{key:"onLogouted",value:function(e){}},{key:"onDeviceOnline",value:function(e,t){}},{key:"onDeviceOffline",value:function(e,t){}},{key:"onFailed",value:function(e){}}]),t}(s.Listener)},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),window.indexedDB||(window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange),window.addEventListener("error",function(e){Logger.e&&Logger.e("Error",e.toString())},!1);var n=navigator.userAgent.toLowerCase(),i="ipad"==n.match(/ipad/i),o="iphone os"==n.match(/iphone os/i),r=(n.match(/midp/i),"android"==n.match(/android/i)),a=(n.match(/windows ce/i),n.match(/windows mobile/i),document.compatMode,n.indexOf("opera"),n.indexOf("chrome")>-1),s=n.indexOf("firefox")>-1,c=!a&&!r&&/webkit|khtml/.test(n),u="ActiveXObject"in window,l=(u&&window.XMLHttpRequest,u&&window.XMLHttpRequest&&document.documentMode,u&&!-[1]&&document.documentMode,"Microsoft Internet Explorer"==navigator.appName&&"9."==navigator.appVersion.match(/9./i)),f=(u&&/10\.0/.test(n),u&&n.indexOf("rv:11.0")>-1),d=!c&&!a&&n.indexOf("gecko")>-1,g=(d&&n.indexOf("rv:1.9"),-1!=n.indexOf("windows")||-1!=n.indexOf("win32")),h=-1!=n.indexOf("macintosh")||-1!=n.indexOf("mac os x"),v=(n.indexOf("adobeair"),-1!=n.indexOf("linux")),p=0===window.location.href.toLowerCase().indexOf("https"),y=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;t.Utils={isIPad:i,isIPhone:o,isAndroid:r,isPhone:o||r,isDesktop:!o&&!r&&!i,isWindows:g,isMac:h,isLinux:v,isChrome:a,isFirefox:s,isIE:u,isIE9:l,isIE11:f,isSafari:c,isSecure:p,randomNumber:function(e,t){return Math.floor(Math.random()*(t-e))+e},retrievalDomClass:function(t,n){var i=null;try{i=t.getAttribute("class")}catch(e){return null}if(null!=i&&i.indexOf(n)>=0)return t;var o=t.parentNode;return null!=o&&void 0!==o?e.utils.retrievalDomClass(o,n):null},formatDuration:function(e){var t=e/1e3,n=parseInt(t);if(n<60)return"00:"+(n<10?"0"+n:n);var i=t/60,o=parseInt(Math.floor(i)),r=parseInt(n%60);return(o<10?"0"+o:o)+":"+(r<10?"0"+r:r)},getUrlParams:function(){for(var e=[],t=void 0,n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;i<n.length;i++)t=n[i].split("="),e.push(t[0]),e[t[0]]=t[1];return e},getUrlParam:function(e){var t=this.getUrlParams()[e];return void 0===t?null:t},getCookieVal:function(e){var t=document.cookie.indexOf(";",e);return-1==t&&(t=document.cookie.length),unescape(document.cookie.substring(e,t))},getCookie:function(e){for(var t=e+"=",n=t.length,i=document.cookie.length,o=0;o<i;){var r=o+n;if(document.cookie.substring(o,r)==t)return this.getCookieVal(r);if(0==(o=document.cookie.indexOf(" ",o)+1))break}return null},setCookie:function(e,t,n,i,o,r){document.cookie=e+"="+escape(t)+(n?"; expires="+n:"")+(i?"; path="+i:"")+(o?"; domain="+o:"")+(r?"; secure":"")},deleteCookie:function(e,t,n){this.getCookie(e)&&(document.cookie=e+"="+(t?"; path="+t:"")+(n?"; domain="+n:"")+"; expires=Thu, 01-Jan-1970 00:00:01 GMT")},getElementChildren:function(e){if(e.children)return e.children;for(var t=[],n=e.childNodes,i=0;i<n.length;++i)1==n[i].nodeType&&t.push(n[i]);return t},getDrawPosition:function(e,t){var n=void 0===t.touches?this.getMousePos(t):this.getTouchPos(t),i=this.getX(e),o=this.getY(e);return{x:n.x-i,y:n.y-o}},getCursorPosition:function(e){if(void 0===e.touches){return{x:e.clientX||e.pageX,y:e.clientY||e.pageY}}if(e.touches.length>0){return{x:e.touches[0].pageX||e.touches[0].clientX||e.clientX,y:e.touches[0].pageY||e.touches[0].clientY||e.clientY}}return{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}},getMousePos:function(e){var t=e||window.event,n=document.documentElement.scrollLeft||document.body.scrollLeft,i=document.documentElement.scrollTop||document.body.scrollTop;return{x:t.pageX||t.clientX+n,y:t.pageY||t.clientY+i}},getTouchPos:function(e){var t=e||window.event,n=document.documentElement.scrollLeft||document.body.scrollLeft,i=document.documentElement.scrollTop||document.body.scrollTop;return{x:t.touches[0].pageX||t.clientX+n,y:t.touches[0].pageY||t.clientY+i}},getX:function(e){for(var t=e.offsetLeft,n=e;null!=(n=n.offsetParent);)t+=n.offsetLeft;return t},getY:function(e){for(var t=e.offsetTop,n=e;null!=(n=n.offsetParent);)t+=n.offsetTop;return t},fixNumber:function(e){var t=new Number(e);return Number(t.toFixed(2))},fixNumberToString:function(e){return new Number(e).toFixed(2)},unselectable:function(e){e.setAttribute("unselectable","on"),e.onmousedown=function(){return!1};var t=e.style;t.userSelect="none",t.webkitUserSelect="none",t.MozUserSelect="-moz-none"},verifyEmail:function(e){return y.test(e)},isSocketSupported:function(){return void 0!==window.WebSocket},isSVGSupported:function(){return!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect},isDBSupported:function(){return void 0!==window.indexedDB},isRecorderSupported:function(){return void 0!==(window.StereoRecorder||window.MediaStreamRecorder||window.WhammyRecorder||window.GifRecorder||window.CanvasRecorder)},isVideoSupported:function(){return!!document.createElement("video").canPlayType},isUserMediaSupported:function(){if(c&&null==navigator.getUserMedia)return!1;var e=navigator.userAgent.indexOf("Chrome/");if(e>0){var t=navigator.userAgent.substr(e+7),n=t.indexOf(".");if(n>0){t=t.substring(0,n);if(parseInt(t)<37)return!1}}return void 0!==navigator.getUserMedia||void 0!==window.getUserMedia},measureBandwidth:function(e,t,n,i){var o=e?1054738:10561396,r=0,a=0,s=0,c=new Image;c.onload=function(){clearTimeout(s),s=0,a=Date.now();var e=(a-r)/1e3,n=8*o,i=(n/e).toFixed(2),c=(i/1024).toFixed(2),u=(c/1024).toFixed(2);t.call(null,i,c,u)},c.onerror=function(e,t){n.call(null,e)},r=Date.now();var u="?t="+r,l="assets/bandwidth/"+(e?"bandwidth-1m.jpg":"bandwidth-10m.jpg")+u;void 0!==i&&(l="http://"+i+"/"+l),c.src=l,s=setTimeout(function(){clearTimeout(s),s=0,n.call(null)},3e4)},requestGet:function(e,t,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){4==i.readyState&&(200==i.status?t.call(null,JSON.parse(i.responseText)):n.call(null,i.status))},i.open("GET",e),i.send(null)},parseXml:function(e){var t=null;if(!window.DOMParser&&window.ActiveXObject)for(var n=["MSXML.2.DOMDocument.6.0","MSXML.2.DOMDocument.3.0","Microsoft.XMLDOM"],i=0;i<n.length;i++)try{t=new ActiveXObject(n[i]),t.async=!1,t.loadXML(e);break}catch(e){}else{if(!(window.DOMParser&&document.implementation&&document.implementation.createDocument))return null;try{t=(new DOMParser).parseFromString(e,"text/xml")}catch(e){}}return t},getUserMedia:function(e,t,n){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||window.getUserMedia;var i={video:e,audio:t};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(i).then(function(e){n(!1,e)}).catch(function(e){n(e)}):navigator.getUserMedia?navigator.getUserMedia(i,function(e){n(!1,e)},function(e){n(e)}):n({code:CubeStateCode.NotSupportUserMedia})},getLocalUUID:function(){var e=localStorage.getItem("CUBE_LOCAL_UUID");return null==e&&(e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),localStorage.setItem("CUBE_LOCAL_UUID",e)),e},closeMediaStream:function(e){if("function"==typeof e.stop)e.stop();else for(var t=[e.getAudioTracks(),e.getVideoTracks()],n=0;n<t.length;n++){var i=t[n];if(i&&i.length>0)for(var o=0;o<i.length;o++){var r=i[o];"function"==typeof r.stop&&r.stop()}}}};!function(e){var t=void 0,n=function(){},i=e.document,o={set:n,get:n,remove:n,clear:n,each:n,obj:n,length:0};!function(){if("localStorage"in e)try{return void(t=e.localStorage)}catch(e){}var n=i.getElementsByTagName("head")[0],o=e.location.hostname||"localStorage",r=new Date,a=void 0,s=void 0;if(n.addBehavior){try{s=new ActiveXObject("htmlfile"),s.open(),s.write('<script>document.w=window;<\/script><iframe src="/favicon.ico"></iframe>'),s.close(),a=s.w.frames[0].document,n=a.createElement("head"),a.appendChild(n)}catch(e){n=i.getElementsByTagName("head")[0]}try{r.setDate(r.getDate()+36500),n.addBehavior("#default#userData"),n.expires=r.toUTCString(),n.load(o),n.save(o)}catch(e){return}var c=void 0,u=void 0;try{c=n.XMLDocument.documentElement,u=c.attributes}catch(e){return}var l=new RegExp("^p__hack_"),f=new RegExp("m-_-c","g"),d=function(e){return encodeURIComponent("p__hack_"+e).replace(/%/g,"m-_-c")},g=function(e){return decodeURIComponent(e.replace(f,"%")).replace(l,"")};t={length:u.length,isVirtualObject:!0,getItem:function(e){return(u.getNamedItem(d(e))||{nodeValue:null}).nodeValue||c.getAttribute(d(e))},setItem:function(e,t){try{c.setAttribute(d(e),t),n.save(o),this.length=u.length}catch(e){}},removeItem:function(e){try{c.removeAttribute(d(e)),n.save(o),this.length=u.length}catch(e){}},clear:function(){for(;u.length;)this.removeItem(u[0].nodeName);this.length=0},key:function(e){return u[e]?g(u[e].nodeName):void 0}},"localStorage"in e||(e.localStorage=t)}else try{t=e.localStorage}catch(e){t=null}}(),e.LS=t?{set:function(e,n){void 0!==this.get(e)&&this.remove(e),t.setItem(e,n),this.length=t.length},get:function(e){var n=t.getItem(e);return null===n?void 0:n},remove:function(e){t.removeItem(e),this.length=t.length},clear:function(){t.clear(),this.length=0},each:function(e){var t=this.obj(),n=e||function(){},i=void 0;for(i in t)if(!1===n.call(this,i,this.get(i)))break},obj:function(){var e={},n=0,i=void 0,o=void 0;if(t.isVirtualObject)e=t.key(-1);else for(i=t.length;n<i;n++)o=t.key(n),e[o]=this.get(o);return e},length:t.length}:o,e.jQuery&&(e.jQuery.LS=e.LS)}(window)}).call(t,n(24))},,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionServiceWorker=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(82),c=n(52),u=n(4),l=n(7),f=n(1),d=n(3);t.ConnectionServiceWorker=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.TAG="fldyconnection",n.speaks=new HashMap,n.MAX_TIMES=9,n.TRY_TIMES=0,n.SPACE_TIME=2e3,n.connectServerUseTime=0,n.startTime=0,n.block=!1,n.serverCallTask=null,n.host=null,n.port=null,n.services=[],n.talkService=null,n.nucleus=null,n.license=null,n.engine=e,n.isQuitted=!1,n.maxReconnectTime=2e4,n.reConnectTimer=null,c.NetworkDetection.startup({connect:function(){n.engine.networkConnected=!0,"string"==typeof n.engine.accName&&"string"==typeof n.engine.accPassword&&(n.isQuitted?n.engine.isReconnecting&&n.reConnect():n.engine.getUserService()._fireRegistrationState(l.RegistrationState.Ok))},disconnect:function(){n.engine.networkConnected=!1,n.engine.triggerCubeEngineState(CubeState.Start),n.engine.registered&&n.engine.getUserService()._fireRegistrationState(l.RegistrationState.Cleared)}}),n}return r(t,e),a(t,[{key:"updateLicense",value:function(e){this.license=e}},{key:"isInit",value:function(){return null!=nucleus&&null!=this.talkService}},{key:"init",value:function(){if(null==this.talkService)return this.config=new NucleusConfig,this.nucleus=nucleus.createNucleus(this.config),this.talkService=nucleus.getTalkService(),!0}},{key:"destroy",value:function(){null!=this.talkService&&(this.talkService.hangup(this.host,this.port,!0),this.talkService=null),null!=this.nucleus&&(this.nucleus.destroy(),this.nucleus=null)}},{key:"isConnected",value:function(){if(null!=this.talkService&&!this.speaks.isEmpty()){this.connect=!0;var e=!0,t=!1,n=void 0;try{for(var i,o=this.speaks.keySet()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var r=i.value;this.talkService.isCalled(r)||(this.connect=!1)}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}return connect}return!1}},{key:"isConnected",value:function(e){if(null!=this.talkService&&!e.isEmpty()){this.connect=!0;var t=!0,n=!1,i=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;this.talkService.isCalled(a)||(this.connect=!1)}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}return connect}return!1}},{key:"disConnected",value:function(e){if(null!=this.talkService&&!e.isEmpty()){this.connect=!0;var t=!0,n=!1,i=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;this.talkService.isCalled(a)||(this.connect=!1)}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}}},{key:"connect",value:function(e,t,n,i,o){if(null!=this.talkService&&n){this.block=o,this.host=e,this.port=t,null!=this.services?this.services.push(n):this.services=n,this.talkService.addListener(this);var r=new InetAddress("192.168.1.6",7070);nucleus.talkService.call(n,r,!0)}}},{key:"getServers",value:function(){return null}},{key:"send",value:function(e,t,n,i){if(null!=this.talkService){var o=new ActionDialect;return o.setName(t),o.addParam("param",n),this.talkService.talk(e,o)}}},{key:"onListened",value:function(e,t,n){if(n.isStuffList()){var i=new ActionDialect(t,n);this.engine.onDialogue(t,i.getName(),i);var o=0;i.getParamAsString("state")&&(o=i.getParamAsString("state").code),Logger.i("*** onListened: "+t+"-----action: "+i.getName()+"-----code: "+o,"-----data: "+JSON.stringify(i.getParamAsString("data")))}}},{key:"onSpoke",value:function(e,t,n){if(n.isStuffList()){var i=new ActionDialect(t,n);this.engine.onDialogue(t,i.getName(),i),Logger.i("*** onSpoke: "+t+"primitive JSON: "+JSON.stringify(i.getParamAsString("state"))),console.log("*** code: "+i.getParamAsString("state").code),console.log("*** data: "+JSON.stringify(i.getParamAsString("param")))}}},{key:"onSpeakAck",value:function(e,t,n){if(n.isStuffList()){new ActionDialect(t,n)}}},{key:"onSpeakTimeout",value:function(e,t,n){console.log("*** onSpeakTimeout: "+t+"primitive JSON: "+JSON.stringify(n))}},{key:"onContacted",value:function(e,t){if(Logger.d("CubeEngine","*** contacted: "+t),t===u.CELLET.Responder)return void this.engine.responder.fireContacted();this.isQuitted=!1,this.engine.isReconnecting=!1,"string"!=typeof this.engine.accName||"string"!=typeof this.engine.accPassword||this.engine.isBeingRegister||this.reLogin(0)}},{key:"quitted",value:function(e,t){if(Logger.d("CubeEngine","*** quitted: "+e),e==u.CELLET.Responder)return void this.engine.responder.fireQuitted();this.isQuitted=!0,this._reConnect()}},{key:"failed",value:function(e,t){Logger.d("CubeEngine","*** failed: "+e+" - "+t.getDescription()),this.isQuitted=!0,this._reConnect()}},{key:"contacted",value:function(e,t){if(Logger.d("CubeEngine","*** contacted: "+e),e===u.CELLET.Responder)return void this.engine.responder.fireContacted();this.isQuitted=!1,this.engine.isReconnecting=!1,"string"!=typeof this.engine.accName||"string"!=typeof this.engine.accPassword||this.engine.isBeingRegister||this.reLogin(0)}},{key:"reConnect",value:function(){var e=this;clearTimeout(this.reConnectTimer);var t=this.engine.getUserService();this.engine.isReconnecting=!0;var n=1e4;!function i(){"string"==typeof e.engine.accName&&"string"==typeof e.engine.accPassword&&(nucleus.talkService.tryRecall(),e.reConnectTimer=setTimeout(function(){e.engine.isReconnecting&&(e.engine.loadingLicense=!0,t.loadLicense(e.engine.accToken,function(n,o){n?500==n.code&&(t._handUp(),t._fireRegistrationState(l.RegistrationState.Failed,new f.CubeError(d.StateCode.GetLicenseFail,"GetLicense Failed")),t.engine.isLicenseLoaded=!1):(window.nucleus._resetTag(),e.engine.loadingLicense=!1,e.engine.isBeingRegister=!1,e.engine.server.update(o),t._updateLicense(o,!0)),i()}),setTimeout(function(){e.engine.loadingLicense&&i()},1e4))},n)),n<e.maxReconnectTime&&(n+=5e3)}()}},{key:"reLogin",value:function(e){var t=this;e<5?(this.engine.getUserService().login(this.engine.accName,this.engine.accPassword,this.engine.accToken,this.engine.accDisplayName),setTimeout(function(){!t.engine.registered&&t.engine.isBeingRegister&&"string"==typeof t.engine.accName&&"string"==typeof t.engine.accPassword&&t.reLogin(e++)},1e4)):this.engine.getUserService()._fireRegistrationState(l.RegistrationState.Failed,new f.CubeError(d.StateCode.ReLoginTimeout,"auto re login failed"))}},{key:"_reConnect",value:function(){this.engine.isShutdown||this.engine.isReconnecting||this.reConnect(),null!=this.engine.getCallService()&&this.engine.session.isCalling()&&this.engine.getCallService().terminateCall(),this.engine.registered&&this.engine.getUserService()._fireRegistrationState(l.RegistrationState.Cleared),null!=this.engine.sipService&&this.engine.sipService.unregister()}}]),t}(s.ConnectionService)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.NetworkDetection=function(){function e(t){var n=this;i(this,e),this.options=t,this.online=function(){null!=n.options&&n.options.connect()},this.offline=function(){null!=n.options&&n.options.disconnect()}}return o(e,[{key:"startup",value:function(){window.addEventListener("online",this.online,!1),window.addEventListener("offline",this.offline,!1)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.online,!1),window.removeEventListener("offline",this.offline,!1)}}],[{key:"startup",value:function(t){null!=this.detection&&this.detection.shutdown(),this.detection=new e(t),this.detection.startup()}},{key:"shutdown",value:function(){null!=this.detection&&(this.detection.shutdown(),this.detection=null)}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkListener=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=(n(8),n(52)),c=n(4),u=n(7),l=n(1),f=n(3);t.NetworkListener=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.engine=e,n.isQuitted=!1,n.maxReconnectTime=2e4,n.reConnectTimer=null,s.NetworkDetection.startup({connect:function(){n.engine.networkConnected=!0,"string"==typeof n.engine.accName&&"string"==typeof n.engine.accPassword&&(n.isQuitted?n.engine.isReconnecting&&n.reConnect():n.engine.getUserService()._fireRegistrationState(u.RegistrationState.Ok))},disconnect:function(){n.engine.networkConnected=!1,n.engine.triggerCubeEngineState(CubeState.Start),n.engine.registered&&n.engine.getUserService()._fireRegistrationState(u.RegistrationState.Cleared)}}),n}return r(t,e),a(t,[{key:"dialogue",value:function(e,t){if(t.isDialectal()){var n=t.getDialect();ActionDialect.DIALECT_NAME===n.getName()&&this.engine.onDialogue(e,n.getAction(),n)}}},{key:"contacted",value:function(e,t){if(Logger.d("CubeEngine","*** contacted: "+e),e===c.CELLET.Responder)return void this.engine.responder.fireContacted();this.isQuitted=!1,this.engine.isReconnecting=!1,"string"!=typeof this.engine.accName||"string"!=typeof this.engine.accPassword||this.engine.isBeingRegister||this.reLogin(0)}},{key:"quitted",value:function(e,t){if(Logger.d("CubeEngine","*** quitted: "+e),e==c.CELLET.Responder)return void this.engine.responder.fireQuitted();this.isQuitted=!0,this._reConnect()}},{key:"failed",value:function(e,t){Logger.d("CubeEngine","*** failed: "+e+" - "+t.getDescription());var n=t.getSourceCelletIdentifiers();if(null!=n&&1==n.length&&n[0]==c.CELLET.Responder)return void this.engine.responder.fireFailed(t);this.isQuitted=!0,this._reConnect()}},{key:"reConnect",value:function(){var e=this;clearTimeout(this.reConnectTimer);var t=this.engine.getUserService();this.engine.isReconnecting=!0;var n=1e4;!function i(){"string"==typeof e.engine.accName&&"string"==typeof e.engine.accPassword&&(nucleus.talkService.tryRecall(),e.reConnectTimer=setTimeout(function(){e.engine.isReconnecting&&(e.engine.loadingLicense=!0,t.loadLicense(e.engine.accToken,function(n,o){n?500==n.code&&(t._handUp(),t._fireRegistrationState(u.RegistrationState.Failed,new l.CubeError(f.StateCode.GetLicenseFail,"GetLicense Failed")),t.engine.isLicenseLoaded=!1):(window.nucleus._resetTag(),e.engine.loadingLicense=!1,e.engine.isBeingRegister=!1,e.engine.server.update(o),t._updateLicense(o,!0)),i()}),setTimeout(function(){e.engine.loadingLicense&&i()},1e4))},n)),n<e.maxReconnectTime&&(n+=5e3)}()}},{key:"reLogin",value:function(e){var t=this;e<5?(this.engine.getUserService().login(this.engine.accName,this.engine.accPassword,this.engine.accToken,this.engine.accDisplayName),setTimeout(function(){!t.engine.registered&&t.engine.isBeingRegister&&"string"==typeof t.engine.accName&&"string"==typeof t.engine.accPassword&&t.reLogin(e++)},1e4)):this.engine.getUserService()._fireRegistrationState(u.RegistrationState.Failed,new l.CubeError(f.StateCode.ReLoginTimeout,"auto re login failed"))}},{key:"_reConnect",value:function(){this.engine.isShutdown||this.engine.isReconnecting||this.reConnect(),null!=this.engine.getCallService()&&this.engine.session.isCalling()&&this.engine.getCallService().terminateCall(),this.engine.registered&&this.engine.getUserService()._fireRegistrationState(u.RegistrationState.Cleared),null!=this.engine.sipService&&this.engine.sipService.unregister()}}]),t}(TalkListener)},,,,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.CubeEngine=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(27),a=n(25),s=n(32),c=n(89),u=n(87),l=(n(53),n(1)),f=n(3),d=n(4),g=n(81),h=n(9),v=n(79),p=n(26),y=n(83),m=n(51);t.CubeEngine=function(){function t(){i(this,t),this.version="2.3.13",this.utils=s.Utils,this.session=new r.Session,this.accName=null,this.accDisplayName=null,this.accPassword=null,this.accToken=null,this.hostAddress=null,this.config=new a.CubeConfig,this.services=new HashMap,this.sspMediaService=null,this.sipMediaService=null,this.sipService=null,this.isReconnecting=!1,this.isBeingRegister=!1,this.loadLicenseCounts=0,this.resourcePath="./assets",this.isShutdown=!1,this.responder=new g.Responder(this.session),this.registered=!1,this.appLicense=null,this.deviceInfo=null,this.isLicenseLoaded=!1;var n=_cube_timestamp+"";this._cube_token=n.substr(n.length-6,6),this.cubeState=p.CubeState.Stop,this.networkConnected=!0,this.delegate=new h.Delegate(v.CubeEngineListener),this.celletMembers=new HashMap,this.server=new y.CubeServer,this.connect=new m.ConnectionServiceWorker(this),this.nodeIntegration=void 0!==e&&e.exports}return o(t,[{key:"_adjust",value:function(e){void 0!==e.host&&(_CUBE_DOMAIN=e.host.toString()),void 0!==e.port&&(_CUBE_PORT=parseInt(e.port))}},{key:"setCubeConfig",value:function(e){e instanceof a.CubeConfig?this.config=e:this.config=new a.CubeConfig(e);for(var t=this.services.values(),n=0;n<t.length;n++)t[n].onConfigure(this.config)}},{key:"startup",value:function(e){var t=this;Logger.i("CubeEngine","Cube Engine for HTML5/JavaScript v"+this.version),this.isShutdown=!1,this._cube_token=this.utils.randomNumber(1e5,999999)+"";var n=function(){return t.connect.init()?(t.loadAccount(),t.loadGroup(),e(!1),t.delegate.onStarted(),t.triggerCubeEngineState(p.CubeState.Start),!0):(t.delegate.onError(),e(new l.CubeError(f.StateCode.InitFailed,"Cube Engine initialization failed!")),!1)};return this.utils.isIE9?(window.WEB_SOCKET_FORCE_FLASH=!0,nucleus.activateWSPlugin(_CUBE_DOMAIN.indexOf("192")>=0?"libs/ws":"http://"+_CUBE_DOMAIN+"/libs/ws",function(){n()})):n(),!0}},{key:"shutdown",value:function(){this.isShutdown=!0,window.nucleus.shutdown();for(var e=this.services.values(),t=0;t<e.length;t++)e[t].shutdown();this.services.clear(),this.server=new y.CubeServer,this.delegate.onStopped(),this.triggerCubeEngineState(p.CubeState.Stop)}},{key:"getCubeEngineState",value:function(){return this.cubeState}},{key:"triggerCubeEngineState",value:function(e){this.cubeState=e,this.delegate.onStateChange(e)}},{key:"addListener",value:function(e){this.delegate.addListener(e)}},{key:"removeListener",value:function(e){this.delegate.addListener(e)}},{key:"getSession",value:function(){return this.session}},{key:"loadService",value:function(e,t){if("function"==typeof t){for(var n=arguments.length,i=Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];if("Whiteboard"===e&&i.length>1&&"string"==typeof i[1]&&(e="Whiteboard"+i[1]),!this.services.containsKey(e)){var r=new(Function.prototype.bind.apply(t,[null].concat([this],i)));r.startup(),this.services.put(e,r)}return!0}return!1}},{key:"loadAccount",value:function(){return this.loadService("Account",c.UserServiceWorker)}},{key:"loadGroup",value:function(){return this.loadService("Group",u.GroupServiceWorker)}},{key:"loadMessager",value:function(){return this.loadService("Message",window.CubeMessageServiceWorker)}},{key:"loadFileManager",value:function(){return this.loadService("Cloud",window.CubeFileManagerServiceWorker)}},{key:"loadInstruction",value:function(){return this.loadService("Instruction",window.CubeInstructionServiceWorker)}},{key:"loadSignaling",value:function(e,t,n){var i=this.loadService("Call",window.CubeCallServiceWorker,document.getElementById(e),document.getElementById(t),void 0!==n?document.getElementById(n):null);return i&&(nucleus.ts.isWebSocketSupported()||(Logger.i("CubeEngine","Adapter WebSocket"),nucleus.ts.resetHeartbeat(d.CELLET.Signaling,2e3))),i}},{key:"loadRemoteDesktop",value:function(e,t){return this.loadService("RemoteDesktop",window.CubeRemoteDesktopServiceWorker,e,t)}},{key:"loadConference",value:function(e,t,n,i){var o=this.loadService("Conference",window.CubeConferenceServiceWorker);return o&&(this.sipService=new CubeSIPServiceWorker,this.sipService.start(this,document.getElementById(e),document.getElementById(t),void 0!==n?document.getElementById(n):null),this.sipMediaService=new CubeMediaServiceWorker(this.sipService,i)),o}},{key:"loadWhiteboard",value:function(e,t){return this.loadService("Whiteboard",window.CubeWhiteboardServiceWorker,e,t)}},{key:"loadLive",value:function(e,t){return this.loadService("Live",window.CubeLiveServiceWorker,e,t)}},{key:"getUserService",value:function(){return this.services.get("Account")}},{key:"getGroupService",value:function(){return this.services.get("Group")}},{key:"getMessageService",value:function(){return this.services.get("Message")}},{key:"getCallService",value:function(){return this.services.get("Call")}},{key:"getMediaService",value:function(){return null!=this.session.callPeer&&this.session.callPeer.name.length<=4&&null!=this.sipService?this.sipMediaService:this.sspMediaService}},{key:"getWhiteboardService",value:function(e){return"string"==typeof e?this.services.get("Whiteboard"+e):this.services.get("Whiteboard")}},{key:"getConferenceService",value:function(){return this.services.get("Conference")}},{key:"getFileManagerService",value:function(){return this.services.get("Cloud")}},{key:"getInstructionService",value:function(){return this.services.get("Instruction")}},{key:"getRemoteDesktopService",value:function(){return this.services.get("RemoteDesktop")}},{key:"getLiveService",value:function(){return this.services.get("Live")}},{key:"getDeviceInfo",value:function(){if(null==this.deviceInfo){var e=null!=this.config&&void 0!==this.config.deviceName?this.config.deviceName:navigator.appName;this.deviceInfo={name:e,version:navigator.appVersion,platform:navigator.platform,deviceId:this.utils.getLocalUUID()}}return this.deviceInfo}},{key:"_parseICEServers",value:function(e){for(var t=[],n=[],i=e,o=0;o<i.length;o++){var r=i[o];null!=r.Username&&null!=r.Password&&n.push({urls:"turn:"+r.Host+":"+r.Port,username:r.Username,credential:r.Password}),t.push("stun:"+r.Host+":"+r.Port)}return t.length>0&&n.push({urls:t}),n}},{key:"setResourcePath",value:function(e){if(this.resourcePath=e,"function"==typeof window.CubeWhiteboardServiceWorker)for(var t=this.services.values(),n=0;n<t.length;n++){var i=t[n];i instanceof CubeWhiteboardServiceWorker&&i.core.updateResourcePath()}}},{key:"addCelletMember",value:function(e,t){var n=this.celletMembers.get(e);n instanceof Array?n.push(t):(n=[t],_VALID_CELLETS.push(e)),this.celletMembers.put(e,n)}},{key:"removeCelletMember",value:function(e,t){var n=this.celletMembers.get(e);if(n instanceof Array){for(var i=0;i<n.length;i++)n[i]===t&&n.splice(i,1);this.celletMembers.put(e,n)}}},{key:"onDialogue",value:function(e,t,n){if(e===d.CELLET.Responder)this.responder.fireDialogue(t,n);else{var i=this.celletMembers.get(e);if(i instanceof Array)for(var o=0;o<i.length;o++)i[o].onDialogue(t,n)}}},{key:"warmUp",value:function(e,t){var n=this;if(null==this.getCallService())return void(void 0!==t&&t());var i=navigator.getUserMedia||window.getUserMedia;if(void 0===i||null==i)return void(void 0!==t&&t());var o=document.body.style.overflow,r=window.innerWidth,a=window.innerHeight;document.body.style.overflow="hidden";var s=parseInt(.5*(r-480)),c=parseInt(.5*(a-480))-40,u=parseInt(.5*(r-200-200-40)),l=parseInt(c+480+10),f=['<div style="position:absolute;float:left;left:0px;top:0px;opacity:0.7;-moz-opacity:0.7;-webkit-opacity:0.7;background:#000;',"width:",r,"px;height:",a,'px"></div>','<video id="_cube_warmup_video" width="480" height="480" style="position:absolute;float:left;left:',s,"px;top:",c,'px;background:#101010;" autoplay></video>','<button id="_cube_warmup_yes" style="width:200px;height:30px;position:absolute;float:left;left:',u,"px;top:",l,'px;">我看到了视频</button>','<button id="_cube_warmup_no" style="width:200px;height:30px;position:absolute;float:left;left:',u+240,"px;top:",l,'px;">我没有看到视频</button>'],d=document.createElement("div");d.style.position="absolute",d.style.styleFloat="left",d.style.cssFloat="left",d.style.left="0px",d.style.top="0px",d.style.width=r+"px",d.style.height=a+"px",d.style.zIndex=9998,d.innerHTML=f.join(""),document.body.appendChild(d);var g=document.getElementById("_cube_warmup_video"),h=null;(this.utils.isIE||this.utils.isSafari)&&(navigator.getUserMedia=window.getUserMedia),navigator.getUserMedia({audio:!0,video:!0},function(e){if(h=e,n.utils.isIE||n.utils.isSafari)return window.attachMediaStream(g,e),g=document.getElementById("_cube_warmup_video"),g.style.position="absolute",g.style.styleFloat="left",g.style.cssFloat="left",g.style.left=s+"px",g.style.top=c+"px",void(g.style.zIndex=9999);window.URL?g.src=window.URL.createObjectURL(h):g.src=h,g.onloadedmetadata=function(e){g.play()}},function(e){document.body.removeChild(d),document.body.style.overflow=o,void 0!==t&&t()});var v=function(){n.utils.isIE||n.utils.isSafari?window.attachMediaStream(document.getElementById("_cube_warmup_video"),null):g.src="",null!=h&&(h.stop(),h=null),document.body.removeChild(d),document.body.style.overflow=o},p=document.getElementById("_cube_warmup_yes");p.addEventListener("click",function(t){v(),void 0!==e&&e.call(null)},!1),p=document.getElementById("_cube_warmup_no"),p.addEventListener("click",function(e){v(),void 0!==t&&t()},!1)}}]),t}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.DBEntity=function(){function e(t,n){i(this,e),this.id=t,this.tableName=n}return o(e,[{key:"toJSON",value:function(){var e={};for(var t in this)"function"!=typeof this[t]&&"baseprototype"!=t&&"tableName"!=t&&(e[t]=this[t]);return e}},{key:"onChange",value:function(e){}}]),e}()},function(e,t,n){"use strict";function i(e){var t=new o.CubeDBCore,n=[];this.isConnect=!1,this.loadEntity=function(e){var n=new e,i=[];for(var o in n.toJSON())"id"!=o&&i.push(o);t.loadTable(n.tableName,i)},this.connect=function(i){var o=this;t.open(e,function(){if(o.isConnect=!0,null!=i&&i(),n.length>0)for(var e=0;e<n.length;e++)o[n[e].action].apply(o,n[e].args);n=null})},this.setEntity=function(e,i){this.isConnect?t.setItem(e.tableName,e.toJSON(),i):n[n.length]={action:"setEntity",args:arguments}},this.getEntity=function(e,i){this.isConnect?t.getItem(e.tableName,e.id,i):n[n.length]={action:"getEntity",args:arguments}},this.getEntityByColumn=function(e,i,o,r){this.isConnect?t.getItemByColumn(e.tableName,i,o,r):n[n.length]={action:"getEntityByColumn",args:arguments}},this.getEntitysByColumn=function(e,i,o,r){this.isConnect?t.getItemsByColumn(e.tableName,i,o,r):n[n.length]={action:"getEntitysByColumn",args:arguments}},this.getEntitysByColumns=function(e,i,o,r){this.isConnect?t.getItemsByColumns(e.tableName,i,o,r):n[n.length]={action:"getEntitysByColumns",args:arguments}},this.getEntitysByManyColumn=function(e,i,o,r){this.isConnect?t.getItemsByManyColumn(e.tableName,i,o,r):n[n.length]={action:"getEntitysByManyColumn",args:arguments}},this.getEntitysByColumnAndPage=function(e,i,o,r,a,s,c){this.isConnect?t.getItemsByColumnAndPage(e.tableName,i,o,r,a,s,c):n[n.length]={action:"getEntitysByColumnAndPage",args:arguments}},this.getAllEntity=function(e,i){this.isConnect?t.getAllItem(e.tableName,i):n[n.length]={action:"getAllEntity",args:arguments}},this.delEntityById=function(e,i,o){this.isConnect?t.delItemById(e.tableName,i,o):n[n.length]={action:"delEntityById",args:arguments}},this.delEntitysByColumn=function(e,i,o,r){this.isConnect?t.delItemsByColumn(e.tableName,i,o,r):n[n.length]={action:"delEntitysByColumn",args:arguments}},this.clearEntity=function(e,i){this.isConnect?t.clearTable(e.tableName,i):n[n.length]={action:"clearEntity",args:arguments}},this.disconnect=function(e){t.close(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.DBManager=i;var o=n(80)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.Peer=function(){function e(t){i(this,e),this.name=t,this.displayName=null,this.latency=-1}return o(e,[{key:"getName",value:function(){return this.name}},{key:"getDisplayName",value:function(){return this.displayName}},{key:"getLatency",value:function(){return this.latency}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Permission={READ:"read",WRITE:"write"}},,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var i=n(57),o=n(13),r=n(6),a=n(58),s=n(59),c=n(8),u=n(14),l=n(1),f=n(4),d=n(3),g=n(32),h=n(9),v=n(60),p=n(27),y=n(31),m=n(29),b=n(7),C=n(61),k=n(30),S=n(28),w=n(26),E=n(25);!function(e){e._CUBE_DOMAIN=null,e._CUBE_CONF_CAPTURE_SERVICE=null,e._CUBE_PORT=null,e._CUBE_HTTP_SERVICE=null,e._CUBE_HTTPS_SERVICE=null,e._CUBE_SERVICE=null,e._CUBE_STUN_SERVERS=null,e._CUBE_ICE_SERVERS=null,e._VALID_CELLETS=[],e._MSTR_TOKEN="CubeTeam@2015",e._cube_timestamp=Date.now(),e.cube=new i.CubeEngine,e.CubeService=o.Service,e.CubeListener=r.Listener,e.CubeDBEntity=a.DBEntity,e.CubeDBManager=s.DBManager,e.CubeConst=c.CubeConst,e.CubeRequest=u.CubeRequest,e.CubeError=l.CubeError,e.CELLET=f.CELLET,e.CubeStateCode=d.StateCode,e.utils=g.Utils,e.CubeDelegate=h.Delegate,e.CubePeer=v.Peer,e.CubeSession=p.Session,e.CubeUserListener=y.UserListener,e.CubeGroupContext=m.GroupContext,e.CubeRegistrationState=b.RegistrationState,e.CubePermission=C.Permission,e.CubeGroupListener=k.GroupListener,e.CubeDeviceListener=S.DeviceListener,e.CubeState=w.CubeState,e.Cubeconfig=E.CubeConfig,void 0===e._cube_cross&&(e._cube_cross={host:"http://"+_CUBE_DOMAIN,callbackMap:{},addCallback:function(e,t,n){this.callbackMap[e]=t}}),e._cube_cross.queryRecordArchives=function(t,n){var i=document.getElementById(t),o=i.getAttribute("name");e._cube_cross.callbackMap[t].call(null,o,n),document.body.removeChild(i),i=null,delete e._cube_cross.callbackMap[t]}}(window)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.CubeEngineListener=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(6);t.CubeEngineListener=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),a(t,[{key:"onStarted",value:function(){}},{key:"onStateChange",value:function(e){}},{key:"onStopped",value:function(){}},{key:"onFailed",value:function(e){}}]),t}(s.Listener)},function(e,t,n){"use strict";function i(){var e=this,t=[],n=void 0;window.indexedDB||(window.indexedDB=window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),window.openDatabase=window.openDatabase||window.mozOpenDatabase||window.webkitOpenDatabase||window.msOpenDatabase,window.indexedDB?(this.open=function(e,i){var o=window.indexedDB.open(e,"4");o.onsuccess=function(e){n=o.result,i()},o.onupgradeneeded=function(e){for(var n=0;n<t.length;n++){var i=t[n];e.currentTarget.result.objectStoreNames.contains(i.name)&&e.currentTarget.result.deleteObjectStore(i.name);for(var o=e.currentTarget.result.createObjectStore(i.name,{keyPath:"id"}),r=0;r<i.columns.length;r++)o.createIndex(i.columns[r],i.columns[r],{unique:!1})}},o.onerror=function(e){throw new Error("Open database error: "+e.target.errorCode)}},this.close=function(e){null!=n&&(n.close(),null!=e&&setTimeout(e,500))},this.deleteDB=function(e,t){var n=window.indexedDB.deleteDatabase(e);n.onerror=function(e){t(e.target)},n.success=function(e){t(!1)}},this.setItem=function(e,t,i){var o=n.transaction(e,"readwrite"),r=o.objectStore(e),a=r.put(t);a.onsuccess=function(){o=null,i(!1)},a.onerror=function(e){o=null,i(e)}},this.getItem=function(e,t,i){n.transaction(e,"readwrite").objectStore(e).get(t).onsuccess=function(e){i(!1,e.target.result)}},this.getItemByColumn=function(e,t,i,o){var r=n.transaction(e).objectStore(e);"boolean"==typeof i&&(i=i?1:0);var a=IDBKeyRange.only(i);r.index(t).get(a).onsuccess=function(e){o(!1,e.target.result)}},this.getItemsByColumn=function(e,t,i,o){var r=n.transaction(e).objectStore(e);"boolean"==typeof i&&(i=i?1:0);var a=IDBKeyRange.only(i),s=r.index(t),c=[],u=s.openCursor(a);u.onsuccess=function(e){var t=e.target.result;t?(c[c.length]=t.value,t.continue()):o(!1,c)},u.onerror=function(e){o(e)}},this.getItemsByColumns=function(e,t,i,o){if(1==i.length)"id"==t?this.getItem(e,i[0],function(e,t){e?o(e):o(!1,[t])}):this.getItemsByColumn(e,t,i[0],o);else{var r=n.transaction(e).objectStore(e),a=[];r.openCursor().onsuccess=function(e){var n=e.target.result;if(n){for(var r=0;r<i.length;r++)if(n.value[t]==i[r]){a.push(n.value);break}n.continue()}else o(!1,a)}}},this.getItemsByManyColumn=function(e,t,i,o){if(t.length>0&&t.length==i.length)if(1==t.length)this.getItemsByColumn(e,t[0],i[0],o);else{var r=n.transaction(e).objectStore(e);"boolean"==typeof i[0]&&(i[0]=i[0]?1:0);var a=IDBKeyRange.only(i[0]),s=r.index(t[0]),c=[];s.openCursor(a).onsuccess=function(e){var n=e.target.result;if(n){for(var r=1;r<t.length&&n.value[t[r]]==i[r];r++)r==t.length-1&&c.push(n.value);n.continue()}else o(!1,c)}}else o(new Error("columnNames and columnValues are inconsistent in length"))},this.getItemsByColumnAndPage=function(e,t,i,o,r,a,s){var c=n.transaction(e).objectStore(e);"boolean"==typeof i&&(i=i?1:0);var u=IDBKeyRange.only(i),l=c.index(t),f=[],d=!0,g="next";a&&(g="prev"),l.openCursor(u,g).onsuccess=function(e){var t=e.target.result;if(t){if(d&&o>0)return d=!1,void t.advance(o);f[f.length]=t.value,f.length<r?t.continue():s(!1,f)}else s(!1,f)}},this.getAllItem=function(e,t){var i=n.transaction(e).objectStore(e),o=[];i.openCursor().onsuccess=function(e){var n=e.target.result;n?(o[o.length]=n.value,n.continue()):t(!1,o)}},this.delItemById=function(e,t,i){n.transaction(e,"readwrite").objectStore(e).delete(t).onsuccess=function(e){i(!1)}},this.delItemsByColumn=function(t,n,i,o){var r=e;"id"==n?e.delItemById(t,i,o):e.getItemsByColumn(t,n,i,function(e,n){if(e)o(e);else if(null!=n&&n.length>0)for(var i=0;i<n.length;i++)!function(e){r.delItemById(t,n[e].id,function(){e==n.length-1&&o(!1)})}(i);else o(!1)})},this.clearTable=function(e,t){n.transaction(e,"readwrite").objectStore(e).clear().onsuccess=function(){t(!1)}}):window.openDatabase&&(this.open=function(e,i){n=window.openDatabase(e,"","",104857600),""==n.version?n.changeVersion(n.version,"4",function(){},function(e){throw e},function(){n.transaction(function(e){for(var n=0;n<t.length;n++){var o=t[n];e.executeSql("CREATE TABLE "+o.name+" (id unique,"+o.columns.toString()+")")}i()})}):"4"==n.version?i():n.changeVersion(n.version,"4",function(){},function(e){throw e},function(){})},this.close=function(){n=null},this.deleteDB=function(e,t){n.transaction(function(e){e.executeSql("SELECT name FROM sqlite_master where type = ?",["table"],function(e,n){for(var i=0,o=n.rows.length;i<o;i++){var r=n.rows.item(i).name;0!=r.indexOf("__")&&e.executeSql("DROP TABLE "+r,null)}t(!1)},function(e,n){t(n)})})},this.setItem=function(e,t,i){n.transaction(function(n){var o=[],r=[],a=[];for(var s in t)o.push(s),r.push("?"),a.push(t[s]);n.executeSql("REPLACE INTO "+e+" ("+o.toString()+") VALUES ("+r.toString()+")",a,function(){i(!1)},function(e,t){i(t)})})},this.getItem=function(e,t,i){n.transaction(function(n){n.executeSql("SELECT * FROM "+e+" WHERE id = ?",[t],function(e,t){i(!1,t.rows.length>0?t.rows.item(0):null)},function(e,t){i(t)})})},this.getItemByColumn=function(e,t,i,o){n.transaction(function(n){n.executeSql("SELECT * FROM "+e+" WHERE "+t+" = ?",[i],function(e,t){o(!1,t.rows.length>0?t.rows.item(0):null)},function(e,t){o(t)})})},this.getItemsByColumn=function(e,t,i,o){n.transaction(function(n){n.executeSql("SELECT * FROM "+e+" WHERE "+t+" = ?",[i],function(e,t){for(var n=[],i=0,r=t.rows.length;i<r;i++)n.push(t.rows.item(i));o(!1,n)},function(e,t){o(t)})})},this.getItemsByColumns=function(e,t,i,o){n.transaction(function(n){n.executeSql("SELECT * FROM "+e+" WHERE "+t+" in (?"+new Array(i.length).join(",?")+")",i,function(e,t){for(var n=[],i=0,r=t.rows.length;i<r;i++)n.push(t.rows.item(i));o(!1,n)},function(e,t){o(t)})})},this.getItemsByManyColumn=function(e,t,i,o){t.length>0&&t.length==i.length?n.transaction(function(n){n.executeSql("SELECT * FROM "+e+" WHERE "+t.join("=? and ")+"=?",i,function(e,t){for(var n=[],i=0,r=t.rows.length;i<r;i++)n.push(t.rows.item(i));o(!1,n)},function(e,t){o(t)})}):o(new Error("columnNames and columnValues are inconsistent in length"))},this.getItemsByColumnAndPage=function(e,t,i,o,r,a,s){n.transaction(function(n){n.executeSql("SELECT * FROM "+e+" WHERE "+t+"=?"+(a?" ORDER BY id DESC":"")+" LIMIT ?,?",[i,o,r],function(e,t){for(var n=[],i=0,o=t.rows.length;i<o;i++)n.push(t.rows.item(i));s(!1,n)},function(e,t){s(t)})})},this.getAllItem=function(e,t){n.transaction(function(n){n.executeSql("SELECT * FROM "+e,null,function(e,n){for(var i=[],o=0,r=n.rows.length;o<r;o++)i.push(n.rows.item(o));t(!1,i)},function(e,n){t(n)})})},this.delItemById=function(e,t,i){n.transaction(function(n){n.executeSql("DELETE FROM "+e+" WHERE id=?",[t],function(){i(!1)},function(e,t){i(t)})})},this.delItemsByColumn=function(e,t,i,o){n.transaction(function(n){n.executeSql("DELETE FROM "+e+" WHERE "+t+"=?",[i],function(){o(!1)},function(e,t){o(t)})})},this.clearTable=function(e,t){n.transaction(function(n){n.executeSql("DELETE FROM "+e,null,function(){t(!1)},function(e,n){t(n)})})}),this.loadTable=function(e,n){t.push({name:e,columns:n})}}Object.defineProperty(t,"__esModule",{value:!0}),t.CubeDBCore=i},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Responder=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(8),a=n(3),s=n(4);t.Responder=function(){function e(t){i(this,e),this.session=t,this.timer=0,this.lastTimestamp=null,this.query=!1}return o(e,[{key:"start",value:function(e,t,n){this.query=void 0!==t&&t,void 0===n&&(n=!0);var i=new InetAddress(e,4005);if(nucleus.talkService.call([s.CELLET.Responder],i,n)){var o=this;return this.timer=setTimeout(function(){o._timerHandler()},1e4),!0}return!1}},{key:"stop",value:function(){this.timer>0&&(clearTimeout(this.timer),this.timer=0),this.session.latency=-1,null!=this.session.callPeer&&(this.session.callPeer.latency=-1),nucleus.talkService.hangUp(s.CELLET.Responder)}},{key:"_timerHandler",value:function(){if(clearTimeout(this.timer),this.timer=0,nucleus.talkService.isCalled(s.CELLET.Responder)){var e=new ActionDialect;e.setAction(r.CubeConst.ActionTime),e.appendParam("timestamp",{originate:Date.now()}),nucleus.talkService.talk(s.CELLET.Responder,e)}var t=this;this.timer=setTimeout(function(){t._timerHandler()},6e4)}},{key:"fireDialogue",value:function(e,t){if(e==r.CubeConst.ActionTimeAck){var n=t.getParam("state");if(n.code==a.StateCode.Ok){this.lastTimestamp=t.getParam("timestamp"),this.lastTimestamp.arrive=Date.now();var i={name:this.session.name.toString(),timestamp:this.lastTimestamp},o=this.lastTimestamp.arrive-this.lastTimestamp.originate-(this.lastTimestamp.transmit-this.lastTimestamp.receive);this.session.latency=o;var c=new ActionDialect;c.setAction(r.CubeConst.ActionRespond),c.appendParam("data",i),nucleus.talkService.talk(s.CELLET.Responder,c)}else Logger.e("CubeResponder","Error '"+e+"' : "+n.code+" : "+n.desc)}else if(e==r.CubeConst.ActionRespondAck){var u=t.getParam("state");if(u.code==a.StateCode.Ok){if(this.query){var l=this.session.callPeer.name;if(null!=l){var f=new ActionDialect;f.setAction(r.CubeConst.ActionQueryRespond),f.appendParam("name",l.toString()),nucleus.talkService.talk(s.CELLET.Responder,f)}}}else Logger.e("CubeResponder","Error '"+e+"' : "+u.code+" : "+u.desc)}else if(e==r.CubeConst.ActionQueryRespondAck){var d=t.getParam("state");if(d.code==a.StateCode.Ok){var g=t.getParam("data");if(g.name==this.session.callPeer.name){var h=g.timestamp,v=h.arrive-h.originate-(h.transmit-h.receive);this.session.callPeer.latency=v}}}}},{key:"fireContacted",value:function(){}},{key:"fireQuitted",value:function(){}},{key:"fireFailed",value:function(e){this.timer>0&&(clearTimeout(this.timer),this.timer=0)}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionService=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(51);t.ConnectionService=function(){function e(){i(this,e),this.TAG="fldyconnection",this.instance=null}return o(e,[{key:"updateLicense",value:function(e){}},{key:"isInit",value:function(){}},{key:"init",value:function(){}},{key:"destroy",value:function(){}},{key:"isConnected",value:function(){}},{key:"isConnected",value:function(e){}},{key:"isConnected",value:function(e){}},{key:"disConnected",value:function(e){}},{key:"disConnected",value:function(){}},{key:"connect",value:function(e,t,n){}},{key:"connect",value:function(e,t,n,i){}},{key:"getServers",value:function(){}},{key:"send",value:function(e,t,n,i){}},{key:"sleep",value:function(){}},{key:"wakeup",value:function(){}}],[{key:"getInstance",value:function(){return null==this.instance&&(Logger.i(TAG,"ConnectionService:new"),e.instance=new r.ConnectionServiceWorker),e.instance}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.CubeServer=function(){function e(){i(this,e),this.host=null,this.port=null,this.httpHost=null,this.httpPort=null,this.ssl="https:"===location.protocol}return o(e,[{key:"update",value:function(e){this.host=_CUBE_DOMAIN=e.CubeServer.Host,this.httpHost=e.CubeHttpServer.Host,_CUBE_HTTP_SERVICE="https://"+e.CubeHttpServer.Host+":"+e.CubeHttpServer.HTTPPort,_CUBE_HTTPS_SERVICE="https://"+e.CubeHttpServer.Host+":"+e.CubeHttpServer.SSLPort,this.ssl?(this.port=_CUBE_PORT=e.CubeServer.HTTPPort+10,this.httpPort=e.CubeHttpServer.SSLPort,_CUBE_CONF_CAPTURE_SERVICE=e.Conference.SSLCapture):(this.port=_CUBE_PORT=e.CubeServer.HTTPPort,this.httpPort=e.CubeHttpServer.HTTPPort,_CUBE_CONF_CAPTURE_SERVICE=e.Conference.HTTPCapture),_CUBE_SERVICE=this.http}},{key:"socket",get:function(){return(this.ssl?"wss://":"ws://")+this.host+":"+this.port}},{key:"http",get:function(){return(this.ssl?"https://":"http://")+this.httpHost+":"+this.httpPort}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.LicenseManager=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(14),a=n(1),s=n(3);t.LicenseManager=function(){function e(t,n,o){i(this,e),this.storageKey="CUBE_LICENSE_KEY_"+o,this.address="http://license.getcube.cn/auth/license/get",this.engine=t,this.token=n,this.appid=o;var r=localStorage.getItem(this.storageKey);this.appLicense=r?JSON.parse(r):null}return o(e,[{key:"checkAndUpdate",value:function(e,t){var n=this,i=new r.CubeRequest(""),o={token:this.token,appid:this.appid,version:this.engine.version,type:"json"};this.appLicense&&(o.lastUpdateTime=this.appLicense.UpdateTime),i.send(e||this.address,o,function(e,i){if(e)return void t(new a.CubeError(s.StateCode.LoadLicenseFailed,"Network error."));if(200===i.state){var o=i.data.license,r=parseFloat(o.ConfigVersion);if(r<1.8||r>2)return void t(new a.CubeError(s.StateCode.LoadLicenseFailed,"License version version is too old!"));if(Date.now()>o.EndDate)return void t(new a.CubeError(s.StateCode.LoadLicenseFailed,"License has expired!"));localStorage.setItem(n.storageKey,JSON.stringify(o)),n.engine.server.update(o),t(!1,!0,o)}else 201===i.state?t(!1,!1,n.appLicense):t(new a.CubeError(i.state,"Incorrect access."))})}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.GroupService=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(13);t.GroupService=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),a(t,[{key:"createGroup",value:function(e,t,n){}},{key:"deleteGroup",value:function(e){}},{key:"addMembers",value:function(e,t){}},{key:"removeMembers",value:function(e,t){}},{key:"queryGroups",value:function(e,t){}},{key:"queryGroupDetails",value:function(e,t,n){}},{key:"addMaster",value:function(e,t){}},{key:"removeMaster",value:function(e,t){}},{key:"changeGroupName",value:function(e,t){}}]),t}(s.Service)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(13);t.UserService=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),a(t,[{key:"login",value:function(e,t,n,i){}},{key:"logout",value:function(){}},{key:"queryAccounts",value:function(e,t){}},{key:"queryOnlineDevice",value:function(e,t){}},{key:"queryOnlineDeviceById",value:function(e,t){}}]),t}(s.Service)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.GroupServiceWorker=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(85),c=n(30),u=n(8),l=n(4),f=n(29);t.GroupServiceWorker=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,c.GroupListener,l.CELLET.Master));return n.queryGroupsCb=null,n.queryGroupsErrorCb=null,n.queryGroupDetailsCb=null,n.queryGroupDetailsErrorCb=null,n}return r(t,e),a(t,[{key:"createGroup",value:function(e,t,n){var i={displayName:e.toString()};void 0!==t&&null!=t&&(i.members=t),void 0!==n&&(i.conference=n);var o={token:_MSTR_TOKEN,group:i};return this.engine.connect.send(l.CELLET.Master,u.CubeConst.ActionCreateGroup,o)}},{key:"deleteGroup",value:function(e){var t={name:e.toString()};return this.engine.connect.send(l.CELLET.Master,u.CubeConst.ActionDeleteGroup,{token:_MSTR_TOKEN,group:t})}},{key:"addMembers",value:function(e,t){var n={token:_MSTR_TOKEN,group:{name:e.toString(),members:t}};return this.engine.connect.send(l.CELLET.Master,u.CubeConst.ActionAddMember,n)}},{key:"removeMembers",value:function(e,t){var n={token:_MSTR_TOKEN,group:{name:e.toString(),members:t}};return this.engine.connect.send(l.CELLET.Master,u.CubeConst.ActionRemoveMember,n)}},{key:"queryGroups",value:function(e,t){this.queryGroupsCb=e,void 0!==t&&(this.queryGroupsErrorCb=t);var n=this.engine.session.name,i={token:_MSTR_TOKEN,name:n.toString()};return this.engine.connect.send(l.CELLET.Master,u.CubeConst.ActionQueryGroups,i)}},{key:"queryGroupDetails",value:function(e,t,n){this.queryGroupDetailsCb=t,void 0!==n&&(this.queryGroupDetailsErrorCb=n);var i={token:_MSTR_TOKEN,group:e};return this.engine.connect.send(l.CELLET.Master,u.CubeConst.ActionGetGroup,i)}},{key:"addMaster",value:function(e,t){var n={token:_MSTR_TOKEN,group:{name:e.toString(),master:t}};return this.engine.connect.send(l.CELLET.Master,u.CubeConst.ActionAddMaster,n)}},{key:"removeMaster",value:function(e,t){var n={token:_MSTR_TOKEN,group:{name:e.toString(),master:t}};return this.engine.connect.send(l.CELLET.Master,u.CubeConst.ActionRemoveMaster,n)}},{key:"changeGroupName",value:function(e,t){var n={token:_MSTR_TOKEN,name:e,group:{name:e.toString(),displayName:t}};return this.engine.connect.send(l.CELLET.Master,u.CubeConst.ActionChangeGroupName,n)}},{key:"onDialogue",value:function(e,t){var n=t.getParamAsString("state");if(e==u.CubeConst.ActionQueryGroupsAck)if(200==n.code){if(null!=this.queryGroupsCb){var i=t.getParamAsString("data");this.queryGroupsCb.call(null,t.getParamAsString("data").groups),i.ackCount==i.ackIndex&&(this.queryGroupsCb=null)}}else null!=this.queryGroupsErrorCb&&(this.queryGroupsErrorCb.call(null,n.code),this.queryGroupsErrorCb=null);else if(e==u.CubeConst.ActionGetGroupAck)200==n.code?null!=this.queryGroupDetailsCb&&(this.queryGroupDetailsCb.call(null,t.getParamAsString("group")),this.queryGroupDetailsCb=null):null!=this.queryGroupDetailsErrorCb&&(this.queryGroupDetailsErrorCb.call(null,n.code),this.queryGroupDetailsErrorCb=null);else if(e==u.CubeConst.ActionCreateGroupAck)null!=this.delegate&&(200==n.code?this.delegate.onGroupCreated(new f.GroupContext(t.getParamAsString("group")),t.getParamAsString("customId")):this.delegate.onFailed(n.code));else if(e==u.CubeConst.ActionDeleteGroupAck)null!=this.delegate&&(200==n.code?this.delegate.onGroupDeleted(new f.GroupContext(t.getParamAsString("group"))):this.delegate.onFailed(n.code));else if(e==u.CubeConst.ActionAddMemberAck){if(null!=this.delegate)if(200==n.code){var o=t.getParamAsString("group");this.delegate.onMemberAdded(new f.GroupContext(o),o.members,o.addedMembers)}else this.delegate.onFailed(n.code)}else if(e==u.CubeConst.ActionRemoveMemberAck){if(null!=this.delegate)if(200==n.code){var r=t.getParamAsString("group");this.delegate.onMemberRemoved(new f.GroupContext(r),r.members,r.removedMembers)}else this.delegate.onFailed(n.code)}else if(e==u.CubeConst.ActionCreateGroup)null!=this.delegate&&this.delegate.onGroupCreated(new f.GroupContext(t.getParamAsString("group")));else if(e==u.CubeConst.ActionDeleteGroup)null!=this.delegate&&this.delegate.onGroupDeleted(new f.GroupContext(t.getParamAsString("group")));else if(e==u.CubeConst.ActionAddMember){if(null!=this.delegate){var a=t.getParamAsString("group");this.delegate.onMemberAdded(new f.GroupContext(a),a.members,a.addedMembers)}}else if(e==u.CubeConst.ActionRemoveMember){if(null!=this.delegate){var s=t.getParamAsString("group");this.delegate.onMemberRemoved(new f.GroupContext(s),s.members,s.removedMembers)}}else if(e==u.CubeConst.ActionAddMasterAck){if(null!=this.delegate)if(200==n.code){var c=t.getParamAsString("group");this.delegate.onMasterAdded(new f.GroupContext(c),c.addedMaster)}else this.delegate.onFailed(n.code)}else if(e==u.CubeConst.ActionRemoveMasterAck){if(null!=this.delegate)if(200==n.code){var l=t.getParamAsString("group");this.delegate.onMasterRemoved(new f.GroupContext(l),l.removedMaster)}else this.delegate.onFailed(n.code)}else if(e==u.CubeConst.ActionChangeGroupNameAck&&null!=this.delegate)if(200==n.code){var d=t.getParamAsString("group");this.delegate.onGroupNameChanged(new f.GroupContext(d))}else this.delegate.onFailed(n.code)}}]),t}(s.GroupService)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AccountAction={ActionLicense:"license",ActionLicenseAck:"license-ack"}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.UserServiceWorker=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(86),c=n(31),u=n(4),l=n(7),f=n(8),d=n(14),g=n(1),h=n(3),v=n(28),p=n(9),y=n(88),m=n(84),b=n(53);t.UserServiceWorker=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,c.UserListener,u.CELLET.Master));return n.deviceListener=new p.Delegate(v.DeviceListener),n.queryCallback=null,n.queryDeviceCallback=null,n.queryDeviceByIdCallback=null,n.licenseManager=null,n}return r(t,e),a(t,[{key:"login",value:function(e,t,n,i){var o=this;return console.log("[Cube#UserService] login to "+e+", "+t+", "+n+", "+i),"string"==typeof e&&(this.engine.accName=e,this.engine.accPassword=t,this.engine.accDisplayName="string"!=typeof i?e:i,this.engine.accToken=n,this.engine.session.name=e,this.engine.session.displayName=this.engine.accDisplayName,this.engine.isLicenseLoaded?this._handleRegister(e,t,i,n,0):this.loadLicense(n,function(i,r){i?500==i.code?(o.engine.isLicenseLoaded=!1,o._fireRegistrationState(l.RegistrationState.Failed,new g.CubeError(h.StateCode.GetLicenseFail,"GetLicense Failed")),o._handUp()):o._fireRegistrationState(l.RegistrationState.Failed,new g.CubeError(h.StateCode.BadRequest,"Request Failed")):o._handleRegister(e,t,o.engine.accDisplayName,n,0)}),!0)}},{key:"logout",value:function(){if(console.log("[Cube#UserService] logout current account"),"string"!=typeof this.engine.accName)return!1;if(this.engine.session.isCalling()&&this.engine.getCallService().terminateCall(),null!=this.engine.sipService&&this.engine.sipService.unregister(),nucleus.talkService.isCalled(u.CELLET.Master)){var e=null!=this.engine.config&&void 0!==this.engine.config.deviceName?this.engine.config.deviceName:navigator.appName,t={name:this.engine.accName,password:this.engine.accPassword,version:this.engine.version,device:{name:e,version:navigator.appVersion,platform:navigator.platform,userAgent:navigator.userAgent}};null!=this.engine.accToken&&(t.token=this.engine.accToken),this.engine.connect.send(u.CELLET.Master,f.CubeConst.ActionLogout,t)}return this.engine.accName=null,this.engine.accDisplayName=null,this.engine.accPassword=null,this.engine.session.name=null,this.engine.session.displayName=null,!0}},{key:"queryAccounts",value:function(e,t){if(this.engine.registered&&"function"==typeof t){this.queryCallback=t;var n={list:e};return null!=this.engine.accToken&&(n.token=this.engine.accToken),this.engine.connect.send(u.CELLET.Master,f.CubeConst.ActionQuery,n),!0}return!1}},{key:"addDeviceListener",value:function(e){this.deviceListener.addListener(e)}},{key:"removeDeviceListener",value:function(e){this.deviceListener.removeListener(e)}},{key:"queryOnlineDevice",value:function(e,t){if(this.engine.registered&&"function"==typeof t){this.queryDeviceCallback=t;var n={name:e};return null!=this.engine.accToken&&(n.token=this.engine.accToken),this.engine.connect.send(u.CELLET.Master,f.CubeConst.ActionQueryDevice,n),!0}return!1}},{key:"queryOnlineDeviceById",value:function(e,t){if(this.engine.registered&&"function"==typeof t){this.queryDeviceByIdCallback=t;var n={deviceId:e};return null!=this.engine.accToken&&(n.token=this.engine.accToken),this.engine.connect.send(u.CELLET.Master,f.CubeConst.ActionQueryByIdDevice,n)}return!1}},{key:"_handleRegister",value:function(e,t,n,i,o){var r=this;if(this.engine.isLicenseLoaded){if(this.engine.isBeingRegister=!0,!(o<20))return this._fireRegistrationState(l.RegistrationState.Failed),!1;if(!nucleus.talkService.isCalled(u.CELLET.Master))return setTimeout(function(){r._handleRegister(e,t,n,i,o++)},500),!0;this._fireRegistrationState(l.RegistrationState.Progress);var a=this.engine.getDeviceInfo();a.userAgent=navigator.userAgent;var s={cubeToken:"cubeTeam",name:e,displayName:this.engine.accDisplayName,password:t,version:this.engine.version,device:a};null!=this.engine.accToken&&(s.token=this.engine.accToken),this.engine.connect.send(u.CELLET.Master,f.CubeConst.ActionLogin,s),setTimeout(function(){r.engine.isBeingRegister&&r._handleRegister(e,t,n,i,o+=5)},5e3)}}},{key:"loadLicense",value:function(e,t){var n=this;this.licenseManager=new m.LicenseManager(this.engine,e,this.engine.config.appid),this.licenseManager.checkAndUpdate(null,function(e,i,o){e?t(e):(n.engine._appLicense=o,n.engine.isLicenseLoaded=!0,n.engine.server.update(o),n.engine.connect.connect(_CUBE_DOMAIN,_CUBE_PORT,_VALID_CELLETS,new b.NetworkListener(n.engine)),t(!1,o))})}},{key:"_fireRegistrationState",value:function(e,t){if(e!==this.engine.session.regState){this.engine.session.regState=e;var n=void 0;e===l.RegistrationState.Progress?this.engine.registered=!1:e===l.RegistrationState.Ok?(this.engine.registered=!0,n="onLogined"):e===l.RegistrationState.Cleared?(this.engine.registered=!1,n="onLogouted",this.engine.session.isCalling()&&this.engine.getCallService().terminateCall(),null!=this.engine.sipService&&this.engine.sipService.unregister()):e===l.RegistrationState.Failed&&(this.engine.registered=!1,n="onFailed");for(var i=this.engine.services.values(),o=0;o<i.length;o++){var r=i[o];if("function"==typeof r.onRegisterStateChanged)try{r.onRegisterStateChanged(this.engine.session)}catch(e){Logger.w("UserService#RegistrationState",e.message)}}"string"==typeof n&&("onFailed"===n?(t||(t=new g.CubeError(h.StateCode.BadRequest,"Handle Failed")),this.delegate[n](t,this.engine.session)):this.delegate[n](this.engine.session))}}},{key:"_processLogin",value:function(e){var t=e.getParamAsString("device");null!=t&&this.deviceListener.onDeviceOnline(t.fromDevice,t.onlineDevices)}},{key:"_processLogout",value:function(e){var t=e.getParamAsString("device");null!=t&&this.deviceListener.onDeviceOffline(t.fromDevice,t.onlineDevices)}},{key:"_processLoginAck",value:function(e){if(this.engine.isBeingRegister=!1,200===e.getParamAsString("state").code){var t=e.getParamAsString("token");null!=t&&void 0!==t&&(this.engine._cube_token=t.toString());var n=e.getParamAsString("ICEServers");null!=n&&(_CUBE_ICE_SERVERS=n,_CUBE_STUN_SERVERS=this.engine._parseICEServers(n)),this._fireRegistrationState(l.RegistrationState.Ok),this.engine.triggerCubeEngineState(CubeState.Ready)}else Logger.w("CubeEngine","login failed"),this._fireRegistrationState(l.RegistrationState.Failed),this.engine.triggerCubeEngineState(CubeState.Start)}},{key:"_processLogoutAck",value:function(e){var t=e.getParamAsString("state");this.engine.triggerCubeEngineState(CubeState.Start),200===t.code?this._fireRegistrationState(l.RegistrationState.Cleared):(Logger.w("CubeEngine","logout failed"),this._fireRegistrationState(l.RegistrationState.Failed))}},{key:"_processQueryAck",value:function(e){if(null!=this.queryCallback){var t=e.getParamAsString("data");null!=t&&this.queryCallback(t.list),this.queryCallback=null}}},{key:"_processQueryDeviceAck",value:function(e){if(null!=this.queryDeviceCallback){var t=e.getParamAsString("device");null!=t&&this.queryDeviceCallback(t.onlineDevices),this.queryDeviceCallback=null}}},{key:"_processQueryDeviceByIdAck",value:function(e){if(null!=this.queryDeviceByIdCallback){var t=e.getParamAsString("data");null!=t&&this.queryDeviceByIdCallback(t),this.queryDeviceByIdCallback=null}}},{key:"_processLicense",value:function(e){var t=this,n=e.getParamAsString("data");if(n)if(n.license&&n.crypUrl){var i=new d.CubeRequest(""),o={license:n.license,number:n.num};i.send(n.crypUrl,o,function(e,n){if((e||200!==n.state)&&Logger.w("CubeEngine"," license Failed! "+e),200===n.state){var i=n.data;t.engine.server.update(i),t._updateLicense(i,!0)}})}else setTimeout(function(){t.licenseManager.checkAndUpdate(n.server,function(e,n,i){if(e)return void Logger.w("CubeEngine","Update license Failed! "+e.message);t.engine.server.update(i),t._updateLicense(i,n)})},5e3)}},{key:"_updateLicense",value:function(e,t){t&&(this.engine._appLicense=e,this.engine.hostAddress=new InetAddress(_CUBE_DOMAIN,_CUBE_PORT),_CUBE_DOMAIN="192.168.1.6",_CUBE_PORT=7070,this.engine.isLicenseLoaded=!0,this._handUp(),nucleus.talkService.call(_VALID_CELLETS,this.engine.hostAddress,this.engine.config.socketEnabled),"string"!=typeof this.engine.accName||"string"!=typeof this.engine.accPassword||this.engine.isBeingRegister||this.login(this.engine.accName,this.engine.accPassword,this.engine.accToken,this.engine.accDisplayName))}},{key:"_handUp",value:function(){nucleus.talkService.hangUp(_VALID_CELLETS[0],!0),this.engine.responder.fireQuitted(),this.engine.getCallService()&&this.engine.session.isCalling()&&this.engine.getCallService().terminateCall(),this.engine.registered&&this._fireRegistrationState(l.RegistrationState.Cleared),this.engine.sipService&&this.engine.sipService.unregister()}},{key:"onDialogue",value:function(e,t){e===f.CubeConst.ActionLogin?this._processLogin(t):e===f.CubeConst.ActionLogout?this._processLogout(t):e===f.CubeConst.ActionLoginAck?this._processLoginAck(t):e===f.CubeConst.ActionLogoutAck?this._processLogoutAck(t):e===f.CubeConst.ActionQueryAck?this._processQueryAck(t):e===f.CubeConst.ActionQueryDeviceAck?this._processQueryDeviceAck(t):e===f.CubeConst.ActionQueryByIdDeviceAck?this._processQueryDeviceByIdAck(t):e===y.AccountAction.ActionLicense&&this._processLicense(t)}}]),t}(s.UserService)}]);
//# sourceMappingURL=cube-core.js.map